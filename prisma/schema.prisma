// NP-Edge Prisma Schema
// Nonprofit Management Platform for Arizona Friends of Foster Children Foundation (AFFCF)

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters", "multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["np_edge"]
}

// ============================================================================
// PROGRAM MANAGEMENT
// ============================================================================

model Program {
  id                  String               @id @default(cuid())
  name                String
  category            ProgramCategory
  status              ProgramStatus
  description         String?
  budget              Float
  spent               Float                @default(0)
  beneficiaries       Int                  @default(0)
  targetBeneficiaries Int
  startDate           DateTime             @map("start_date")
  endDate             DateTime?            @map("end_date")
  manager             String
  impact              Json
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  beneficiaryLinks    BeneficiaryProgram[]
  projects            ProgramProject[]

  @@index([status])
  @@index([category])
  @@index([manager])
  @@map("programs")
  @@schema("np_edge")
}

model Beneficiary {
  id             String               @id @default(cuid())
  name           String
  age            Int
  enrollmentDate DateTime             @map("enrollment_date")
  status         BeneficiaryStatus
  attendanceRate Float?               @map("attendance_rate")
  outcomes       Json
  demographics   Json?
  notes          String?
  createdAt      DateTime             @default(now()) @map("created_at")
  updatedAt      DateTime             @updatedAt @map("updated_at")
  programs       BeneficiaryProgram[]

  @@index([status])
  @@index([enrollmentDate])
  @@map("beneficiaries")
  @@schema("np_edge")
}

model BeneficiaryProgram {
  id            String      @id @default(cuid())
  beneficiaryId String      @map("beneficiary_id")
  programId     String      @map("program_id")
  enrolledAt    DateTime    @default(now()) @map("enrolled_at")
  completedAt   DateTime?   @map("completed_at")
  progress      Int         @default(0)
  beneficiary   Beneficiary @relation(fields: [beneficiaryId], references: [id], onDelete: Cascade)
  program       Program     @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@index([beneficiaryId])
  @@index([programId])
  @@map("beneficiary_programs")
  @@schema("np_edge")
}

model ProgramProject {
  id          String        @id @default(cuid())
  name        String
  programId   String        @map("program_id")
  description String
  progress    Int           @default(0)
  budget      Float
  spent       Float         @default(0)
  startDate   DateTime      @map("start_date")
  dueDate     DateTime      @map("due_date")
  status      ProjectStatus
  assignedTo  String        @map("assigned_to")
  milestones  Json
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  program     Program       @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@index([programId])
  @@index([status])
  @@index([assignedTo])
  @@map("program_projects")
  @@schema("np_edge")
}

// ============================================================================
// FUNDRAISING & DONORS
// ============================================================================

model Donor {
  id              String      @id @default(cuid())
  name            String
  email           String      @unique
  phone           String?
  type            DonorType
  totalGiving     Float       @default(0) @map("total_giving")
  lastGift        DateTime?   @map("last_gift")
  lastGiftAmount  Float?      @map("last_gift_amount")
  status          DonorStatus @default(New)
  memberSince     DateTime    @map("member_since")
  address         String?
  notes           String?
  tags            String[]    @default([])
  engagementScore Int?        @map("engagement_score")
  preferences     Json?
  createdAt       DateTime    @default(now()) @map("created_at")
  updatedAt       DateTime    @updatedAt @map("updated_at")
  donations       Donation[]

  @@index([email])
  @@index([type])
  @@index([status])
  @@index([lastGift])
  @@map("donors")
  @@schema("np_edge")
}

model Donation {
  id           String   @id @default(cuid())
  donorId      String   @map("donor_id")
  amount       Float
  date         DateTime
  campaign     String?
  grantId      String?  @map("grant_id")
  method       String?
  recurring    Boolean  @default(false)
  acknowledged Boolean  @default(false)
  taxReceipt   String?  @map("tax_receipt")
  notes        String?
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  donor        Donor    @relation(fields: [donorId], references: [id], onDelete: Cascade)

  @@index([donorId])
  @@index([date])
  @@index([campaign])
  @@map("donations")
  @@schema("np_edge")
}

model Campaign {
  id          String         @id @default(cuid())
  name        String
  goal        Float
  raised      Float          @default(0)
  donors      Int            @default(0)
  startDate   DateTime       @map("start_date")
  endDate     DateTime       @map("end_date")
  status      CampaignStatus
  type        CampaignType
  description String?
  createdAt   DateTime       @default(now()) @map("created_at")
  updatedAt   DateTime       @updatedAt @map("updated_at")

  @@index([status])
  @@index([type])
  @@index([endDate])
  @@map("campaigns")
  @@schema("np_edge")
}

model Grant {
  id              String      @id @default(cuid())
  funder          String
  program         String
  amount          Float
  status          GrantStatus
  applicationDate DateTime    @map("application_date")
  decisionDate    DateTime?   @map("decision_date")
  reportDue       DateTime?   @map("report_due")
  purpose         String
  notes           String?
  createdAt       DateTime    @default(now()) @map("created_at")
  updatedAt       DateTime    @updatedAt @map("updated_at")

  @@index([status])
  @@index([reportDue])
  @@index([funder])
  @@map("grants")
  @@schema("np_edge")
}

// ============================================================================
// VOLUNTEERS
// ============================================================================

model Volunteer {
  id               String                @id @default(cuid())
  name             String
  email            String                @unique
  phone            String?
  status           VolunteerStatus
  joinDate         DateTime              @map("join_date")
  totalHours       Float                 @default(0) @map("total_hours")
  skills           String[]              @default([])
  interests        String[]              @default([])
  availability     Json?
  emergencyContact Json?                 @map("emergency_contact")
  notes            String?
  createdAt        DateTime              @default(now()) @map("created_at")
  updatedAt        DateTime              @updatedAt @map("updated_at")
  assignments      VolunteerAssignment[]

  @@index([email])
  @@index([status])
  @@index([joinDate])
  @@map("volunteers")
  @@schema("np_edge")
}

model VolunteerAssignment {
  id          String    @id @default(cuid())
  volunteerId String    @map("volunteer_id")
  role        String
  program     String?
  startDate   DateTime  @map("start_date")
  endDate     DateTime? @map("end_date")
  hoursLogged Float     @default(0) @map("hours_logged")
  notes       String?
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  volunteer   Volunteer @relation(fields: [volunteerId], references: [id], onDelete: Cascade)

  @@index([volunteerId])
  @@index([startDate])
  @@map("volunteer_assignments")
  @@schema("np_edge")
}

// ============================================================================
// EVENTS
// ============================================================================

model Event {
  id            String              @id @default(cuid())
  name          String
  type          EventType
  status        EventStatus
  startDate     DateTime            @map("start_date")
  endDate       DateTime?           @map("end_date")
  location      String?
  description   String?
  capacity      Int?
  registered    Int                 @default(0)
  goal          Float?
  raised        Float?
  coordinator   String
  createdAt     DateTime            @default(now()) @map("created_at")
  updatedAt     DateTime            @updatedAt @map("updated_at")
  registrations EventRegistration[]

  @@index([status])
  @@index([type])
  @@index([startDate])
  @@map("events")
  @@schema("np_edge")
}

model EventRegistration {
  id          String    @id @default(cuid())
  eventId     String    @map("event_id")
  name        String
  email       String
  phone       String?
  tickets     Int       @default(1)
  amount      Float?
  attended    Boolean   @default(false)
  checkedInAt DateTime? @map("checked_in_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  event       Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([eventId])
  @@index([email])
  @@map("event_registrations")
  @@schema("np_edge")
}

// ============================================================================
// COMPLIANCE & OUTREACH
// ============================================================================

model Filing {
  id              String         @id @default(cuid())
  category        FilingCategory
  name            String
  formType        String?        @map("form_type")
  description     String
  dueDate         DateTime       @map("due_date")
  status          FilingStatus
  priority        FilingPriority
  completion      Int            @default(0)
  assignedTo      String?        @map("assigned_to")
  submittedDate   DateTime?      @map("submitted_date")
  confirmationNum String?        @map("confirmation_num")
  fee             Float?
  notes           String?
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")

  @@index([category])
  @@index([status])
  @@index([priority])
  @@index([dueDate])
  @@map("filings")
  @@schema("np_edge")
}

model Outreach {
  id         String   @id @default(cuid())
  title      String
  type       String
  audience   String?
  message    String
  sentDate   DateTime @map("sent_date")
  reach      Int      @default(0)
  engagement Int      @default(0)
  conversion Int      @default(0)
  campaign   String?
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@index([sentDate])
  @@index([campaign])
  @@map("outreach")
  @@schema("np_edge")
}

model AuditEvent {
  id         String   @id @default(cuid())
  type       String
  entityType String   @map("entity_type")
  entityId   String   @map("entity_id")
  userId     String   @map("user_id")
  timestamp  DateTime @default(now())
  data       Json

  @@index([entityType, entityId])
  @@index([userId])
  @@index([timestamp])
  @@map("audit_events")
  @@schema("np_edge")
}

// ============================================================================
// ENUMS
// ============================================================================

enum ProgramCategory {
  Education
  Health
  Housing
  FoodSecurity
  YouthServices
  SeniorServices
  Environment
  Arts
  Other
  @@schema("np_edge")
}

enum ProgramStatus {
  Active
  Planned
  Completed
  OnHold
  @@schema("np_edge")
}

enum BeneficiaryStatus {
  Active
  Graduated
  Inactive
  @@schema("np_edge")
}

enum ProjectStatus {
  OnTrack
  AtRisk
  Behind
  Completed
  @@schema("np_edge")
}

enum DonorType {
  Individual
  Corporate
  Foundation
  Government
  @@schema("np_edge")
}

enum DonorStatus {
  Active
  Lapsed
  New
  Prospect
  @@schema("np_edge")
}

enum CampaignType {
  Annual
  Capital
  SpecialEvent
  Emergency
  Major
  @@schema("np_edge")
}

enum CampaignStatus {
  Active
  Completed
  Planned
  @@schema("np_edge")
}

enum GrantStatus {
  Applied
  UnderReview
  Awarded
  Rejected
  Reported
  @@schema("np_edge")
}

enum VolunteerStatus {
  Active
  Inactive
  Pending
  @@schema("np_edge")
}

enum EventType {
  Fundraiser
  Community
  Training
  Awareness
  Volunteer
  @@schema("np_edge")
}

enum EventStatus {
  Planned
  Active
  Completed
  Cancelled
  @@schema("np_edge")
}

enum FilingCategory {
  IRS990
  State
  Donor
  Employment
  SalesTax
  Grant
  Special
  @@schema("np_edge")
}

enum FilingStatus {
  NotStarted
  InProgress
  PendingReview
  Submitted
  Approved
  Rejected
  Overdue
  @@schema("np_edge")
}

enum FilingPriority {
  Critical
  High
  Medium
  Low
  @@schema("np_edge")
}
